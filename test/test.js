import test from "ava";

import {
    Vector,
    NavMesh,
} from "../src/nav2d.js";






test("navmesh_find_path_angle_acos_outside_range", (t) => {
    let serializedCoords = [[{"x":7.5,"y":19.5},{"x":10.0,"y":19.5},{"x":10.0,"y":28.5},{"x":7.5,"y":28.5}],[{"x":10.0,"y":19.5},{"x":12.5,"y":19.5},{"x":12.5,"y":28.5},{"x":10.0,"y":28.5}],[{"x":1.5,"y":19.5},{"x":7.5,"y":19.5},{"x":7.5,"y":23.0},{"x":1.5,"y":23.0}],[{"x":12.5,"y":19.5},{"x":18.5,"y":19.5},{"x":18.5,"y":23.0},{"x":12.5,"y":23.0}],[{"x":1.5,"y":23.0},{"x":2.5,"y":23.0},{"x":2.5,"y":29.5},{"x":1.5,"y":29.5}],[{"x":17.5,"y":23.0},{"x":18.5,"y":23.0},{"x":18.5,"y":29.5},{"x":17.5,"y":29.5}],[{"x":6.5,"y":23.0},{"x":7.5,"y":23.0},{"x":7.5,"y":29.5},{"x":6.5,"y":29.5}],[{"x":12.5,"y":23.0},{"x":13.5,"y":23.0},{"x":13.5,"y":29.5},{"x":12.5,"y":29.5}],[{"x":1.5,"y":29.5},{"x":7.5,"y":29.5},{"x":7.5,"y":34.5},{"x":1.5,"y":34.5}],[{"x":12.5,"y":29.5},{"x":18.5,"y":29.5},{"x":18.5,"y":34.5},{"x":12.5,"y":34.5}],[{"x":7.5,"y":33.5},{"x":10.0,"y":33.5},{"x":10.0,"y":34.5},{"x":7.5,"y":34.5}],[{"x":10.0,"y":33.5},{"x":12.5,"y":33.5},{"x":12.5,"y":34.5},{"x":10.0,"y":34.5}],[{"x":10.0,"y":7.5},{"x":12.5,"y":7.5},{"x":12.5,"y":16.5},{"x":10.0,"y":16.5}],[{"x":7.5,"y":7.5},{"x":10.0,"y":7.5},{"x":10.0,"y":16.5},{"x":7.5,"y":16.5}],[{"x":12.5,"y":13.0},{"x":18.5,"y":13.0},{"x":18.5,"y":16.5},{"x":12.5,"y":16.5}],[{"x":1.5,"y":13.0},{"x":7.5,"y":13.0},{"x":7.5,"y":16.5},{"x":1.5,"y":16.5}],[{"x":17.5,"y":6.5},{"x":18.5,"y":6.5},{"x":18.5,"y":13.0},{"x":17.5,"y":13.0}],[{"x":1.5,"y":6.5},{"x":2.5,"y":6.5},{"x":2.5,"y":13.0},{"x":1.5,"y":13.0}],[{"x":12.5,"y":6.5},{"x":13.5,"y":6.5},{"x":13.5,"y":13.0},{"x":12.5,"y":13.0}],[{"x":6.5,"y":6.5},{"x":7.5,"y":6.5},{"x":7.5,"y":13.0},{"x":6.5,"y":13.0}],[{"x":12.5,"y":1.5},{"x":18.5,"y":1.5},{"x":18.5,"y":6.5},{"x":12.5,"y":6.5}],[{"x":1.5,"y":1.5},{"x":7.5,"y":1.5},{"x":7.5,"y":6.5},{"x":1.5,"y":6.5}],[{"x":10.0,"y":1.5},{"x":12.5,"y":1.5},{"x":12.5,"y":2.5},{"x":10.0,"y":2.5}],[{"x":7.5,"y":1.5},{"x":10.0,"y":1.5},{"x":10.0,"y":2.5},{"x":7.5,"y":2.5}],[{"x":14.5,"y":16.5},{"x":16.5,"y":16.5},{"x":16.5,"y":19.5},{"x":14.5,"y":19.5}],[{"x":3.5,"y":16.5},{"x":5.5,"y":16.5},{"x":5.5,"y":19.5},{"x":3.5,"y":19.5}],[{"x":13.5,"y":10.5},{"x":17.5,"y":10.5},{"x":17.5,"y":13.0},{"x":13.5,"y":13.0}],[{"x":2.5,"y":10.5},{"x":6.5,"y":10.5},{"x":6.5,"y":13.0},{"x":2.5,"y":13.0}],[{"x":13.5,"y":23.0},{"x":17.5,"y":23.0},{"x":17.5,"y":25.5},{"x":13.5,"y":25.5}],[{"x":2.5,"y":23.0},{"x":6.5,"y":23.0},{"x":6.5,"y":25.5},{"x":2.5,"y":25.5}]];


    let deserializedCoords= serializedCoords.map(polygon =>
        polygon.map(point => [point.x,point.y])
    );

    const navmesh = new NavMesh(deserializedCoords,{
        pointQuerySize:0
    });

    const path = navmesh.findPath(
        [10, 8],
        [10, 31]
    );

    t.deepEqual(path, [
        new Vector(321.94381764911583, 311.00705914346884),
        new Vector(145.50164006384801, 335.0348767805669),
    ]);
});
