!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):"function"==typeof define&&define.amd?define(["uuid","point-in-polygon","earcut","simple-quadtree"],n):"object"==typeof exports?exports.nav2d=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):t.nav2d=n(t.uuid,t["point-in-polygon"],t.earcut,t["simple-quadtree"])}("undefined"!=typeof self?self:this,((t,n,e,r)=>(()=>{"use strict";var o={651:t=>{t.exports=e},100:t=>{t.exports=n},395:t=>{t.exports=r},592:n=>{n.exports=t}},i={};function u(t){var n=i[t];if(void 0!==n)return n.exports;var e=i[t]={exports:{}};return o[t](e,e.exports,u),e.exports}u.d=(t,n)=>{for(var e in n)u.o(n,e)&&!u.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},u.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),u.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(n,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,(void 0,i=function(n,e){if("object"!==t(n)||null===n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var o=r.call(n,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(o.key),"symbol"===t(i)?i:String(i)),o)}var i}u.r(a),u.d(a,{Edge:()=>I,NavMesh:()=>M,Point:()=>R,Polygon:()=>A,Vector:()=>r,clip:()=>l,cross:()=>i,dot:()=>o,isclose:()=>s});var e=1e-8,r=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var e,r;return e=t,(r=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return s(this.x,t.x)&&s(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(l(-1,1,o(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return i(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t,n){return t.x*n.x+t.y*n.y}function i(t,n){return t.x*n.y-t.y*n.x}function s(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return t>n-r&&t<n+r}function l(t,n,e){return e<t?t:e>n?n:e}var c=u(592),f=u(100),h=u(651),y=u(395);class p{constructor(t=[],n=d){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const o=t-1>>1,i=n[o];if(e(r,i)>=0)break;n[t]=i,t=o}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,o=n[t];for(;t<r;){let r=1+(t<<1),i=n[r];const u=r+1;if(u<this.length&&e(n[u],i)<0&&(r=u,i=n[u]),e(i,o)>=0)break;n[t]=i,t=r}n[t]=o}}function d(t,n){return t<n?-1:t>n?1:0}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function g(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function b(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?g(Object(e),!0).forEach((function(n){m(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):g(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n,e){return(n=x(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function _(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,o,i,u,a=[],s=!0,l=!1;try{if(i=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;s=!1}else for(;!(s=(r=i.call(e)).done)&&(a.push(r.value),a.length!==n);s=!0);}catch(t){l=!0,o=t}finally{try{if(!s&&null!=e.return&&(u=e.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,n)||F(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=F(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==e.return||e.return()}finally{if(a)throw i}}}}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function k(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function O(t,n,e){return n&&k(t.prototype,n),e&&k(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function x(t){var n=function(t,n){if("object"!==v(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===v(n)?n:String(n)}function S(t,n,e){return S=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,n,e){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(t,r));return e&&j(o,e.prototype),o},S.apply(null,arguments)}function j(t,n){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},j(t,n)}function E(t){return function(t){if(Array.isArray(t))return q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||F(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(t,n){if(t){if("string"==typeof t)return q(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?q(t,n):void 0}}function q(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function C(t){return t instanceof Array?S(r,E(t)):t instanceof r?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new r(t.x,t.y):void 0}var I=function(){function t(n,e){w(this,t),this._uuid=(0,c.v4)(),this.p1=C(n),this.p2=C(e)}return O(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=C(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=o(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof r?t:t.p1.sub(t.p2);return s(i(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return s(i(n,e),0)&&s(i(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),S(t,E(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),A=function(){function t(n){w(this,t),this._uuid=(0,c.v4)(),this.points=n.map(C),this.bounds=this._computeBounds()}return O(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new I(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new r(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=C(t);var n=this.points.map(this._toPointArray);return f(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=C(t);var n,e=P(this.edges());try{for(e.s();!(n=e.n()).done;){var r=n.value;if(r.onEdge(t))return r}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"touches",value:function(t){var n,e=P(this.edges());try{for(e.s();!(n=e.n()).done;){var r=n.value;if((r.onEdge(t.p1)||r.onEdge(t.p2))&&r.collinear(t))return r}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"boundsSize",value:function(){var t=_(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}},{key:"getClosestPointTo",value:function(t){t=C(t);var n,e=null,r=1/0,i=P(this.edges());try{for(i.s();!(n=i.n()).done;){var u=n.value,a=u.direction(),s=Math.pow(a.length(),2);if(0!==s){var l=Math.max(0,Math.min(1,o(t.sub(u.p1),a)/s)),c=u.p1.add(a.mul(l)),f=t.sub(c).length();f<r&&(r=f,e=c)}else{var h=u.p1,y=t.sub(h).length();y<r&&(r=y,e=h)}}}catch(t){i.e(t)}finally{i.f()}return e}}]),t}(),M=function(){function t(n){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w(this,t),this._uuid=(0,c.v4)(),"function"==typeof(r=b({triangulate:!0,pointQuerySize:.01},r))&&(console.warn("DEPRECATION WARNING: nav2d now uses the signature NavMesh(polygons, options = { costFunc: ..., heuristicFunc: ... }) but you are using the old signature NavMesh(polygons, costFunc, heuristicFunc). Please update, the code will break in a future release."),r.costFunc=r),"function"==typeof o&&(console.warn("DEPRECATION WARNING: nav2d now uses the signature NavMesh(polygons, options = { costFunc: ..., heuristicFunc: ... }) but you are using the old signature NavMesh(polygons, costFunc, heuristicFunc). Please update, the code will break in a future release."),r.heuristicFunc=o),this.costFunc=r.costFunc||function(t,n){return e._computeDistance(t,n)},this.heuristicFunc=r.heuristicFunc||function(t,n){return e._computeDistance(t,n)},r.triangulate&&(n=this._triangulate(n)),this.polygons=n.map((function(t){return new A(t)})),this.pointQuerySize=r.pointQuerySize,this._buildQuadtree(),this._buildNeighbors()}return O(t,[{key:"_triangulate",value:function(t){var n,e=this,r=[],o=P(t);try{var i=function(){for(var t=n.value,o=h(e._flatten(t)),i=0;i<o.length/3;i++){var u=o.slice(3*i,3*i+3);r.push(u.map((function(n){return t[n]})))}};for(o.s();!(n=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}return r}},{key:"_flatten",value:function(t){var n,e=[],r=P(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o instanceof Array?e.push.apply(e,E(o)):e.push(o.x,o.y)}}catch(t){r.e(t)}finally{r.f()}return e}},{key:"_buildQuadtree",value:function(){this.qt=y(-1/0,-1/0,1/0,1/0);var t,n=P(this.polygons);try{for(n.s();!(t=n.n()).done;){var e=t.value;this.qt.put(b(b({},e.boundsSize()),{},{polygon:e}))}}catch(t){n.e(t)}finally{n.f()}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n,e=this.polygons[t],r=P(this.qt.get(e.boundsSize()));try{for(r.s();!(n=r.n()).done;){var o=n.value.polygon;if(e!==o&&!e.neighbors.hasOwnProperty(o._uuid)){var i=this._computePortal(e,o);if(null!==i&&i.length()>0){var u=_(this._orderLeftRight(e.centroid(),i.p1,i.p2),2),a=u[0],s=u[1];e.neighbors[o._uuid]={polygon:o,portal:new I(a,s)},o.neighbors[e._uuid]={polygon:e,portal:new I(s,a)}}}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"_computePortal",value:function(t,n){var e,r=P(t.edges());try{for(r.s();!(e=r.n()).done;){var o=e.value,i=n.touches(o);if(null!==i)return o.overlap(i)}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"findPath",value:function(t,n){t=C(t),n=C(n);var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);null===e&&(t=this.findClosestPointInPolygons(t)),null===r&&(n=this.findClosestPointInPolygons(n));var o=this._findPath(t,n);return o&&this._funnel(t,n,o)}},{key:"findClosestPointInPolygons",value:function(t){var n,e=null,r=1/0,o=P(this.polygons);try{for(o.s();!(n=o.n()).done;){var i=n.value.getClosestPointTo(t),u=t.sub(i).length();u<r&&null!==this._findContainingPolygon(i)&&0!==u&&(r=u,e=i)}}catch(t){o.e(t)}finally{o.f()}return e}},{key:"_findPath",value:function(t,n){var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);null===e&&(t=this.findClosestPointInPolygons(t),e=this._findContainingPolygon(t)),null===r&&(n=this.findClosestPointInPolygons(n),r=this._findContainingPolygon(n));for(var o=new p([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),i=m({},e._uuid,null),u=m({},e._uuid,0);o.length;){var a=o.pop().polygon;if(a._uuid===r._uuid)break;for(var s=0,l=Object.values(a.neighbors);s<l.length;s++){var c=l[s].polygon,f=u[a._uuid]+this._computeCost(a,c);(!u.hasOwnProperty(c._uuid)||f<u[c._uuid])&&(o.push({cost:f+this._heuristic(c,r),polygon:c}),u[c._uuid]=f,i[c._uuid]=a)}}return this._reconstructPath(r,i)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:this.heuristicFunc(t,n)}},{key:"_findContainingPolygon",value:function(t){var n,e=this.pointQuerySize/2,r={x:t.x-e,y:t.y-e,w:this.pointQuerySize,h:this.pointQuerySize},o=P(this.qt.get(r));try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.polygon.contains(t))return i.polygon}}catch(t){o.e(t)}finally{o.f()}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];var r=[t],o=[],i=[],u=e[0].neighbors[e[1]._uuid].portal;o.push(u.p1),i.push(u.p2);for(var a=1;a<e.length-1;a++){var s=e[a],l=e[a+1],c=s.neighbors[l._uuid].portal;this._extendFunnel(r,o,i,c.p1,c.p2)}return this._extendFunnel(r,o,i,n,n),r}},{key:"_extendFunnel",value:function(t,n,e,r,o){this._extendFunnelSide(t,n,e,!0,r),this._extendFunnelSide(t,n,e,!1,o)}},{key:"_extendFunnelSide",value:function(t,n,e,r,o){var i=t[t.length-1];if(!r){var u=[e,n];n=u[0],e=u[1]}var a=0===n.length?t[t.length-1]:n[n.length-1];if(!o.equals(a)){var s=this._findFirstLeftOfPoint(i,n,o,!0,!r);if(n.length=s,n.push(o),0===s){var l=this._findFirstLeftOfPoint(i,e,o,!1,r);t.push.apply(t,E(e.splice(0,l)))}}}},{key:"_findFirstLeftOfPoint",value:function(t,n,e,r,o){var i;for(i=0;i<n.length;i++)if(o?this._isInLeftRightOrder(t,e,n[i],r):this._isInLeftRightOrder(t,n[i],e,r))return i;return i}},{key:"_isInLeftRightOrder",value:function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i(n.sub(t),e.sub(t));return r?o<=0:o<0}},{key:"_orderLeftRight",value:function(t,n,e){return this._isInLeftRightOrder(t,n,e)?[n,e]:[e,n]}}]),t}(),R=r})(),a})()));
//# sourceMappingURL=nav2d.min.js.map